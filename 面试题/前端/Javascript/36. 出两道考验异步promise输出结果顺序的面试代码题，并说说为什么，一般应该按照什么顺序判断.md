### 面试题 1

**题目：**

```javascript
console.log('1');

setTimeout(() => {
  console.log('2');
}, 0);

Promise.resolve().then(() => {
  console.log('3');
});

console.log('4');
```

**问题：** 这段代码的输出顺序是什么？为什么？

**答案：**

输出顺序是：`1, 4, 3, 2`。

**解析：**

1. **同步代码**：`console.log('1')` 和 `console.log('4')` 是同步代码，会立即执行，输出 `1` 和 `4`。
2. **微任务（Promise）**：`Promise.resolve().then(...)` 是一个微任务，会被放入微任务队列，在当前同步代码执行完毕后立即执行，输出 `3`。
3. **宏任务（setTimeout）**：`setTimeout` 是一个宏任务，会被放入宏任务队列，等待当前所有同步代码和微任务执行完毕后执行，输出 `2`。

### 面试题 2

**题目：**

```javascript
console.log('A');

Promise.resolve().then(() => {
  console.log('B');
  setTimeout(() => {
    console.log('C');
  }, 0);
});

setTimeout(() => {
  console.log('D');
  Promise.resolve().then(() => {
    console.log('E');
  });
}, 0);

console.log('F');
```

**问题：** 这段代码的输出顺序是什么？为什么？

**答案：**

输出顺序是：`A, F, B, D, E, C`。

**解析：**

1. **同步代码**：`console.log('A')` 和 `console.log('F')` 是同步代码，会立即执行，输出 `A` 和 `F`。
2. **微任务（Promise）**：`Promise.resolve().then(...)` 是一个微任务，会被放入微任务队列，在当前同步代码执行完毕后立即执行，输出 `B`。
   - 在微任务中，`setTimeout` 是一个宏任务，会被放入宏任务队列，等待当前所有同步代码和微任务执行完毕后执行。
3. **宏任务（setTimeout）**：第一个 `setTimeout` 是一个宏任务，会被放入宏任务队列，等待当前所有同步代码和微任务执行完毕后执行，输出 `D`。
   - 在宏任务中，`Promise.resolve().then(...)` 是一个微任务，会被放入微任务队列，在当前宏任务执行完毕后立即执行，输出 `E`。
4. **宏任务（setTimeout）**：第二个 `setTimeout` 是一个宏任务，会被放入宏任务队列，等待当前所有同步代码和微任务执行完毕后执行，输出 `C`。

### 判断异步代码输出顺序的原则

1. **同步代码优先**：同步代码会立即执行，优先级最高。
2. **微任务优先于宏任务**：在当前同步代码执行完毕后，会先执行所有微任务（如 `Promise` 的 `then` 回调），然后再执行宏任务（如 `setTimeout`、`setInterval`）。
3. **事件循环机制**：JavaScript 的事件循环机制会不断检查微任务队列和宏任务队列，确保微任务优先执行。
4. **嵌套任务**：如果在微任务或宏任务中又产生了新的微任务或宏任务，会按照事件循环的规则继续处理。

### 总结

- 同步代码 > 微任务 > 宏任务。
- 微任务和宏任务的嵌套会按照事件循环的规则依次处理。
- 理解事件循环机制是掌握异步代码执行顺序的关键。